<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E2 - Editor Elements - KeyValue Editor Demo</title>
    <link rel="stylesheet" href="main.css" />
    <script src="../build/e2.min.js"></script>
  </head>
  <body>
    <div class="theme-controls">
      <button class="theme-button active" onclick="setTheme('light')">
        Light
      </button>
      <button class="theme-button" onclick="setTheme('dark')">Dark</button>
      <button class="theme-button" onclick="setTheme('auto')">Auto</button>
    </div>

    <header>
      <h1>
        <a href="index.html" style="text-decoration: none; color: inherit">
          &laquo;
        </a>
        E2 - KeyValue Editor Demo
      </h1>
      <p>
        Interactive demonstration of the <code>&lt;e2-keyvalue-editor&gt;</code> element
      </p>
    </header>

    <main>

      <div class="demo-section">
        <h2>Basic Usage</h2>
        <p>Simple object editing without schema validation:</p>

        <e2-keyvalue-editor id="basic-editor"></e2-keyvalue-editor>

        <div class="controls">
          <button onclick="setBasicValue()">Set Sample Data</button>
          <button onclick="getBasicValue()">Get Current Value</button>
          <button onclick="clearBasicValue()">Clear</button>
        </div>

        <div class="output">
          <h3>Current Value:</h3>
          <pre id="basic-output">{}</pre>
        </div>
      </div>

      <div class="demo-section">
        <h2>Header Title Configuration</h2>
        <p>Demonstration of configurable header titles:</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
          <div>
            <h3>No Header (default)</h3>
            <e2-keyvalue-editor id="no-header-editor"></e2-keyvalue-editor>
          </div>
          <div>
            <h3>Custom Header Title</h3>
            <e2-keyvalue-editor id="custom-header-editor" header-title="Game Settings"></e2-keyvalue-editor>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
          <div>
            <h3>Default "Properties" Header</h3>
            <e2-keyvalue-editor id="default-header-editor" header-title=""></e2-keyvalue-editor>
          </div>
          <div>
            <h3>Dynamic Header</h3>
            <e2-keyvalue-editor id="dynamic-header-editor" header-title="Configuration"></e2-keyvalue-editor>
          </div>
        </div>

        <div class="controls">
          <button onclick="setHeaderSampleData()">Set Sample Data</button>
          <button onclick="toggleDynamicHeader()">Toggle Dynamic Header</button>
          <button onclick="changeDynamicHeaderTitle()">Change Dynamic Title</button>
          <button onclick="clearHeaderEditors()">Clear All</button>
        </div>
      </div>

      <div class="demo-section">
        <h2>Advanced Input Types</h2>
        <p>Showcase of all supported input types with schema constraints:</p>

        <e2-keyvalue-editor id="advanced-editor"></e2-keyvalue-editor>

        <div class="controls">
          <button onclick="setAdvancedValue()">Set Sample Data with Advanced Types</button>
          <button onclick="getAdvancedValue()">Get Current Value</button>
          <button onclick="validateAdvanced()">Validate</button>
          <button onclick="clearAdvancedValue()">Clear</button>
        </div>

        <div class="output">
          <h3>Current Value:</h3>
          <pre id="advanced-output">{}</pre>
          <h3>Validation:</h3>
          <pre id="advanced-validation">Not validated</pre>
        </div>
      </div>

      <div class="demo-section">
        <h2>Nested Objects</h2>
        <p>Editing objects with nested properties using collapsible sections:</p>

        <e2-keyvalue-editor id="nested-editor"></e2-keyvalue-editor>

        <div class="controls">
          <button onclick="setNestedValue()">Set Nested Data</button>
          <button onclick="getNestedValue()">Get Current Value</button>
          <button onclick="clearNestedValue()">Clear</button>
        </div>

        <div class="output">
          <h3>Current Value:</h3>
          <pre id="nested-output">{}</pre>
        </div>
      </div>

      <div class="demo-section">
        <h2>Comprehensive Schema Demo</h2>
        <p>Complete example with validation, required fields, and error handling:</p>

        <e2-keyvalue-editor id="schema-editor"></e2-keyvalue-editor>

        <div class="controls">
          <button onclick="setSchemaValue()">Set Schema & Sample Data</button>
          <button onclick="getSchemaValue()">Get Current Value</button>
          <button onclick="validateSchema()">Validate</button>
          <button onclick="clearSchemaValue()">Clear</button>
        </div>

        <div class="output">
          <h3>Current Value:</h3>
          <pre id="schema-output">{}</pre>
          <h3>Validation:</h3>
          <pre id="validation-output">Not validated</pre>
        </div>
      </div>

      <div class="demo-section">
        <h2>Theme & Style Options</h2>
        <p>Different themes and layout options:</p>

        <div class="demo-row">
          <div class="demo-container">
            <h3>Compact Mode</h3>
            <e2-keyvalue-editor id="compact-editor" compact></e2-keyvalue-editor>
          </div>

          <div class="demo-container">
            <h3>Read-only Mode</h3>
            <e2-keyvalue-editor id="readonly-editor" readonly></e2-keyvalue-editor>
          </div>
        </div>

        <div class="controls">
          <button onclick="setThemeData()">Set Data for Theme Examples</button>
        </div>
      </div>

      <div class="demo-section">
        <h2>Event Handling</h2>
        <p>Real-time event output:</p>

        <div class="output-container" id="event-output">
          <div>Events will appear here...</div>
        </div>
      </div>

      <div class="demo-section">
        <h2>Code Examples</h2>
        <p>Copy and paste these examples to get started:</p>

        <div class="code-example">
          <h3>Basic KeyValue Editor:</h3>
          <button class="copy-button" onclick="copyToClipboard('basic-code')">
            Copy
          </button>
          <pre id="basic-code">
&lt;e2-keyvalue-editor id="my-editor"&gt;&lt;/e2-keyvalue-editor&gt;

&lt;script&gt;
  const editor = document.getElementById('my-editor');

  // Set initial data
  editor.value = {
    name: 'John Doe',
    age: 30,
    active: true
  };

  // Get current value
  console.log(editor.value);
&lt;/script&gt;</pre>
        </div>

        <div class="code-example">
          <h3>With Schema Validation:</h3>
          <button class="copy-button" onclick="copyToClipboard('schema-code')">
            Copy
          </button>
          <pre id="schema-code">
&lt;e2-keyvalue-editor id="schema-editor"&gt;&lt;/e2-keyvalue-editor&gt;

&lt;script&gt;
  const editor = document.getElementById('schema-editor');

  // Define schema
  editor.schema = {
    type: 'object',
    properties: {
      name: {
        type: 'string',
        title: 'Full Name',
        minLength: 2,
        maxLength: 50
      },
      email: {
        type: 'string',
        format: 'email',
        title: 'Email Address'
      },
      age: {
        type: 'integer',
        minimum: 0,
        maximum: 120
      }
    },
    required: ['name', 'email']
  };

  // Set data
  editor.value = {
    name: 'Jane Smith',
    email: 'jane@example.com',
    age: 25
  };
&lt;/script&gt;</pre>
        </div>

        <div class="code-example">
          <h3>Advanced Input Types:</h3>
          <button class="copy-button" onclick="copyToClipboard('advanced-code')">
            Copy
          </button>
          <pre id="advanced-code">
&lt;e2-keyvalue-editor id="advanced-editor"&gt;&lt;/e2-keyvalue-editor&gt;

&lt;script&gt;
  const editor = document.getElementById('advanced-editor');

  editor.schema = {
    type: 'object',
    properties: {
      color: {
        type: 'string',
        format: 'color',
        title: 'Theme Color'
      },
      volume: {
        type: 'number',
        minimum: 0,
        maximum: 100,
        title: 'Volume Level'
      },
      website: {
        type: 'string',
        format: 'url',
        title: 'Website'
      },
      category: {
        type: 'string',
        enum: ['small', 'medium', 'large'],
        title: 'Size'
      }
    }
  };
&lt;/script&gt;</pre>
        </div>

        <div class="code-example">
          <h3>Event Handling:</h3>
          <button class="copy-button" onclick="copyToClipboard('events-code')">
            Copy
          </button>
          <pre id="events-code">
// Listen for value changes
editor.addEventListener('keyvalue-change', event => {
  const { key, oldValue, newValue, path, isValid } = event.detail;
  console.log(`${key} changed from ${oldValue} to ${newValue}`);
});

// Listen for validation events
editor.addEventListener('keyvalue-validation', event => {
  const { isValid, errors } = event.detail;
  if (!isValid) {
    console.log('Validation errors:', errors);
  }
});

// Programmatic validation
const result = editor.validate();
console.log('Is valid:', result.isValid);</pre>
        </div>
      </div>
    </main>

    <script>
        // Basic editor functionality
        const basicEditor = document.getElementById('basic-editor');
        const basicOutput = document.getElementById('basic-output');

        function setBasicValue() {
            const sampleData = {
                name: 'John Doe',
                age: 30,
                email: 'john@example.com',
                active: true
            };
            basicEditor.value = sampleData;
            updateBasicOutput();
        }

        function getBasicValue() {
            updateBasicOutput();
        }

        function clearBasicValue() {
            basicEditor.value = {};
            updateBasicOutput();
        }

        function updateBasicOutput() {
            basicOutput.textContent = JSON.stringify(basicEditor.value, null, 2);
        }

        // Header title demo functionality
        const noHeaderEditor = document.getElementById('no-header-editor');
        const customHeaderEditor = document.getElementById('custom-header-editor');
        const defaultHeaderEditor = document.getElementById('default-header-editor');
        const dynamicHeaderEditor = document.getElementById('dynamic-header-editor');

        function setHeaderSampleData() {
            const sampleData = {
                username: 'player1',
                difficulty: 'normal',
                soundEnabled: true,
                volume: 75
            };
            noHeaderEditor.value = sampleData;
            customHeaderEditor.value = sampleData;
            defaultHeaderEditor.value = sampleData;
            dynamicHeaderEditor.value = sampleData;
        }

        let headerVisible = true;
        function toggleDynamicHeader() {
            headerVisible = !headerVisible;
            if (headerVisible) {
                dynamicHeaderEditor.headerTitle = 'Configuration';
            } else {
                dynamicHeaderEditor.headerTitle = null;
            }
        }

        let titleIndex = 0;
        const titleOptions = ['Configuration', 'Settings', 'Options', 'Parameters', 'Properties'];
        function changeDynamicHeaderTitle() {
            titleIndex = (titleIndex + 1) % titleOptions.length;
            dynamicHeaderEditor.headerTitle = titleOptions[titleIndex];
        }

        function clearHeaderEditors() {
            noHeaderEditor.value = {};
            customHeaderEditor.value = {};
            defaultHeaderEditor.value = {};
            dynamicHeaderEditor.value = {};
        }

        // Advanced types editor functionality
        const advancedEditor = document.getElementById('advanced-editor');
        const advancedOutput = document.getElementById('advanced-output');
        const advancedValidation = document.getElementById('advanced-validation');

        function setAdvancedValue() {
            const schema = {
                type: 'object',
                properties: {
                    // Text inputs
                    name: {
                        type: 'string',
                        title: 'Name',
                        description: 'Your full name',
                        minLength: 2,
                        maxLength: 50
                    },
                    bio: {
                        type: 'string',
                        title: 'Biography',
                        description: 'Tell us about yourself',
                        maxLength: 500
                    },
                    // Numbers and ranges
                    age: {
                        type: 'integer',
                        title: 'Age',
                        minimum: 13,
                        maximum: 120
                    },
                    volume: {
                        type: 'number',
                        title: 'Volume',
                        description: 'Volume level (0-100)',
                        minimum: 0,
                        maximum: 100,
                        multipleOf: 5
                    },
                    // Specialized string inputs
                    email: {
                        type: 'string',
                        title: 'Email',
                        format: 'email',
                        description: 'Your email address'
                    },
                    website: {
                        type: 'string',
                        title: 'Website',
                        format: 'url',
                        description: 'Your personal website'
                    },
                    phone: {
                        type: 'string',
                        title: 'Phone Number',
                        format: 'tel',
                        pattern: '^\\+?[0-9\\s\\-\\(\\)]+$'
                    },
                    // Color picker
                    favoriteColor: {
                        type: 'string',
                        title: 'Favorite Color',
                        format: 'color',
                        description: 'Pick your favorite color'
                    },
                    // Date and time
                    birthDate: {
                        type: 'string',
                        title: 'Birth Date',
                        format: 'date'
                    },
                    preferredTime: {
                        type: 'string',
                        title: 'Preferred Meeting Time',
                        format: 'time'
                    },
                    // Enum/select
                    category: {
                        type: 'string',
                        title: 'Category',
                        enum: ['developer', 'designer', 'manager', 'student', 'other'],
                        description: 'Choose your primary role'
                    },
                    // Boolean
                    newsletter: {
                        type: 'boolean',
                        title: 'Subscribe to Newsletter',
                        description: 'Receive updates and news'
                    }
                },
                required: ['name', 'email', 'category']
            };

            const sampleData = {
                name: 'Alex Johnson',
                bio: 'Software developer with 5 years of experience in web technologies.',
                age: 28,
                volume: 75,
                email: 'alex@example.com',
                website: 'https://alexjohnson.dev',
                phone: '+1-555-0123',
                favoriteColor: '#3498db',
                birthDate: '1995-06-15',
                preferredTime: '14:30',
                category: 'developer',
                newsletter: true
            };

            advancedEditor.schema = schema;
            advancedEditor.value = sampleData;
            updateAdvancedOutput();
        }

        function getAdvancedValue() {
            updateAdvancedOutput();
        }

        function validateAdvanced() {
            const result = advancedEditor.validate();
            advancedValidation.textContent = JSON.stringify(result, null, 2);
        }

        function clearAdvancedValue() {
            advancedEditor.value = {};
            updateAdvancedOutput();
        }

        function updateAdvancedOutput() {
            advancedOutput.textContent = JSON.stringify(advancedEditor.value, null, 2);
        }

        // Schema editor functionality
        const schemaEditor = document.getElementById('schema-editor');
        const schemaOutput = document.getElementById('schema-output');
        const validationOutput = document.getElementById('validation-output');

        function setSchemaValue() {
            const schema = {
                type: 'object',
                properties: {
                    // Required fields
                    username: {
                        type: 'string',
                        title: 'Username',
                        description: 'Must be unique, 3-20 characters',
                        minLength: 3,
                        maxLength: 20,
                        pattern: '^[a-zA-Z0-9_]+$'
                    },
                    password: {
                        type: 'string',
                        title: 'Password',
                        description: 'At least 8 characters with mixed case and numbers',
                        minLength: 8,
                        pattern: '^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).+$'
                    },
                    // Optional fields with validation
                    score: {
                        type: 'integer',
                        title: 'Score',
                        description: 'Game score (0-1000)',
                        minimum: 0,
                        maximum: 1000,
                        multipleOf: 10
                    },
                    difficulty: {
                        type: 'string',
                        title: 'Difficulty Level',
                        enum: ['easy', 'medium', 'hard', 'expert'],
                        description: 'Choose game difficulty'
                    },
                    notifications: {
                        type: 'boolean',
                        title: 'Enable Notifications',
                        description: 'Receive game updates and alerts'
                    }
                },
                required: ['username', 'password']
            };

            const sampleData = {
                username: 'player123',
                password: 'SecurePass1',
                score: 750,
                difficulty: 'medium',
                notifications: true
            };

            schemaEditor.schema = schema;
            schemaEditor.value = sampleData;
            updateSchemaOutput();
        }

        function getSchemaValue() {
            updateSchemaOutput();
        }

        function validateSchema() {
            const result = schemaEditor.validate();
            validationOutput.textContent = JSON.stringify(result, null, 2);
        }

        function clearSchemaValue() {
            schemaEditor.value = {};
            updateSchemaOutput();
        }

        function updateSchemaOutput() {
            schemaOutput.textContent = JSON.stringify(schemaEditor.value, null, 2);
        }

        // Nested editor functionality
        const nestedEditor = document.getElementById('nested-editor');
        const nestedOutput = document.getElementById('nested-output');

        function setNestedValue() {
            const nestedData = {
                name: 'Game Object',
                visible: true,
                position: {
                    x: 100,
                    y: 200
                },
                scale: {
                    x: 1.5,
                    y: 1.5
                },
                color: {
                    r: 255,
                    g: 128,
                    b: 64
                }
            };
            nestedEditor.value = nestedData;
            nestedEditor.schema = {
              type: 'object',
              properties: {
                name: { type: 'string', minLength: 1, maxLength: 10 },
                position: {
                  type: 'object',
                  properties: {
                    x: { type: 'number', minimum: 0, maximum: 1920 },
                  },
                },
              },
            };

            updateNestedOutput();
        }

        function getNestedValue() {
            updateNestedOutput();
        }

        function clearNestedValue() {
            nestedEditor.value = {};
            updateNestedOutput();
        }

        function updateNestedOutput() {
            nestedOutput.textContent = JSON.stringify(nestedEditor.value, null, 2);
        }

        // Theme examples
        function setThemeData() {
            const sampleData = {
                title: 'Sample Item',
                count: 42,
                enabled: true
            };
            document.getElementById('compact-editor').value = sampleData;
            document.getElementById('readonly-editor').value = sampleData;
        }

        // Event listeners for all editors
        document.querySelectorAll('e2-keyvalue-editor').forEach(editor => {
            editor.addEventListener('keyvalue-change', (event) => {
                console.log('KeyValue changed:', event.detail);
            });

            editor.addEventListener('keyvalue-validation', (event) => {
                console.log('KeyValue validation:', event.detail);
            });
        });

        // Event listeners specifically for the advanced editor
        advancedEditor.addEventListener('keyvalue-change', (event) => {
            console.log('Advanced editor changed:', event.detail);
            updateAdvancedOutput();
        });

        advancedEditor.addEventListener('keyvalue-validation', (event) => {
            console.log('Advanced editor validation:', event.detail);
            advancedValidation.textContent = JSON.stringify(event.detail, null, 2);
        });

        // Event output for demonstration
        const eventOutput = document.getElementById('event-output');

        function addEventToOutput(message) {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.innerHTML = `[${timestamp}] ${message}`;
            eventOutput.appendChild(div);
            eventOutput.scrollTop = eventOutput.scrollHeight;

            // Keep only last 20 events
            while (eventOutput.children.length > 20) {
                eventOutput.removeChild(eventOutput.firstChild);
            }
        }

        // Enhanced event listeners for all editors
        document.querySelectorAll('e2-keyvalue-editor').forEach((editor, index) => {
            const editorName = editor.id || `editor-${index}`;

            editor.addEventListener('keyvalue-change', (event) => {
                const { key, oldValue, newValue, isValid } = event.detail;
                addEventToOutput(`<strong>${editorName}</strong>: "${key}" changed from "${oldValue}" to "${newValue}" (valid: ${isValid})`);
            });

            editor.addEventListener('keyvalue-validation', (event) => {
                const { isValid, errors } = event.detail;
                const errorCount = errors.length;
                addEventToOutput(`<strong>${editorName}</strong>: Validation ${isValid ? 'passed' : `failed (${errorCount} errors)`}`);
            });
        });

        // Copy to clipboard functionality
        function copyToClipboard(id) {
            const element = document.getElementById(id);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const button = element.previousElementSibling;
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }

        // Theme control
        let currentTheme = 'light';

        function setTheme(theme) {
            currentTheme = theme;
            document.body.className = theme === 'auto' ? '' : `theme-${theme}`;

            // Update theme buttons
            document.querySelectorAll('.theme-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Apply theme to all keyvalue editors
            document.querySelectorAll('e2-keyvalue-editor').forEach(editor => {
                editor.theme = theme;
            });
        }

        // Initialize with some sample data
        setTimeout(() => {
            setBasicValue();
            setAdvancedValue();
            setSchemaValue();
            setNestedValue();
            setThemeData();

            addEventToOutput('Demo initialized with sample data');
        }, 100);
    </script>
  </body>
</html>
